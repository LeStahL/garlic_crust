#version 450
uniform sampler2D iChannel0;uniform vec2 iResolution;uniform float iTime;uniform int iFrame;const float v=144.;const vec3 i=vec3(1.,0.,-1.);float x,y,e=120.,z=60./e;const float f=90.;float s(vec2 i){return max(i.x,i.y);}float t(vec2 i){return min(max(max(max(max(min(max(max(s(abs(vec2(abs(abs(i.x)-.25)-.25,i.y))-vec2(.2)),-s(abs(vec2(i.x+.5,abs(abs(i.y)-.05)-.05))-vec2(.12,.02))),-s(abs(vec2(abs(i.x+.5)-.1,i.y-.05*sign(i.x+.5)))-vec2(.02,.07))),s(abs(vec2(i.x+.5,i.y+.1))-vec2(.08,.04))),-s(abs(vec2(i.x,i.y-.04))-vec2(.02,.08))),-s(abs(vec2(i.x,i.y+.1))-vec2(.02))),-s(abs(vec2(i.x-.5,i.y))-vec2(.08,.12))),-s(abs(vec2(i.x-.5,i.y-.05))-vec2(.12,.07))),s(abs(vec2(i.x-.5,i.y))-vec2(.02,.08)));}float p(in float i){return smoothstep(1.5/iResolution.y,-1.5/iResolution.y,i);}float a(vec2 i){vec3 v=fract(vec3(i.xyx)*.1031);v+=dot(v,v.yzx+33.33);return fract((v.x+v.y)*v.z);}float m(vec2 v){vec2 y=floor(v);v=fract(v);v=smoothstep(i.yy,i.xx,v);vec2 x=vec2(a(y),a(y+i.xy)),z=vec2(a(y+i.yx),a(y+i.xx));x=i.zz+2.*mix(x,z,v.y);return mix(x.x,x.y,v.x);}void a(out vec4 a,in vec2 n){float s=mod(iTime,z)-.5*z;y=(iTime-s-.5)/z+smoothstep(-.2*z,.2*z,s);x=smoothstep(-.3*z,0.,s)*smoothstep(.3*z,0.,s);vec3 f=vec3(0.);float e=sqrt(v)-1.;for(float c=-.5*e;c<=.5*e;c+=1.)for(float u=-.5*e;u<=.5*e;u+=1.)f+=texture(iChannel0,n/iResolution.xy+vec2(c,u)*mix(3.,20.,2.*abs(n.y/iResolution.y-.5))*exp(-abs(.01*length(n.xy)/iResolution.y-.5))/max(e,1.)/iResolution.xy).xyz;f/=v;vec2 c=(n.xy-.5*iResolution.xy)/iResolution.y,u=c;c=n/iResolution.xy;vec2 g=1./iResolution.xy;float l=1.,o=3.,r=0.;vec4 d=texture(iChannel0,c+vec2(-g.x,-g.y)),b=texture(iChannel0,c+vec2(0.,-g.y)),h=texture(iChannel0,c+vec2(g.x,-g.y)),R=texture(iChannel0,c+vec2(-g.x,0.)),C=texture(iChannel0,c+vec2(0.,0.)),T=texture(iChannel0,c+vec2(g.x,0.)),F=texture(iChannel0,c+vec2(-g.x,g.y)),D=texture(iChannel0,c+vec2(0.,g.y)),q=texture(iChannel0,c+vec2(g.x,g.y)),Z=d*-l+b*-o+h*-l+F*l+D*o+q*l+C*r,Y=d*-l+R*-o+F*-l+h*l+T*o+q*l+C*r;a=vec4(abs(Y.xyz)*.5+abs(Z.xyz)*.5,1.);a=vec4(mix(f,a.xyz,clamp(.25+.5*m(.5*y*i.xx)+.5*x,0.,1.)),1.);float X=t(8.*(u-.5*vec2(iResolution.x/iResolution.y,1.)+vec2(.1,.04)));a.xyz=mix(a.xyz,mix(a.xyz,i.xxx,.5),p(X));}void main(){a(gl_FragColor,gl_FragCoord.xy);}